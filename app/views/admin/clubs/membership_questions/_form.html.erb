<% frame_dom_id = local_assigns[:frame_id] || (membership_question.persisted? ? dom_id(membership_question) : dom_id(club, :new_membership_question)) %>
<%= turbo_frame_tag frame_dom_id do %>
  <%= form_with model: [:admin, club, membership_question],
                data: {
                  controller: "membership-question-form",
                  membership_question_form_choice_types_value: MembershipQuestion::CHOICE_ANSWER_TYPES.to_json
                },
                class: "space-y-4" do |form| %>
  <% if membership_question.errors.any? %>
    <div class="rounded border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700">
      <%= membership_question.errors.full_messages.to_sentence %>
    </div>
  <% end %>

  <div class="space-y-1">
    <%= form.label :prompt, "Question", class: "block text-sm font-medium text-slate-700" %>
    <%= form.text_area :prompt,
      rows: 2,
      class: "w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-slate-500 focus:outline-none focus:ring" %>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div class="space-y-1">
      <%= form.label :answer_type, "Answer type", class: "block text-sm font-medium text-slate-700" %>
      <%= form.select :answer_type,
        MembershipQuestion::ANSWER_TYPES.map { |type| [type.humanize, type] },
        {},
        class: "w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-slate-500 focus:outline-none focus:ring",
        data: { membership_question_form_target: "answerType", action: "membership-question-form#toggle" } %>
    </div>
    <div class="flex items-center gap-2 pt-6 md:pt-8">
      <%= form.check_box :required, class: "rounded border-slate-300 text-slate-900 focus:ring-slate-500" %>
      <%= form.label :required, "Required", class: "text-sm text-slate-700" %>
    </div>
  </div>

  <div
    class="<%= membership_question.choice_based? ? "" : "hidden" %> space-y-1"
    data-membership-question-form-target="choiceFields"
  >
    <%= form.label :options_text, "Options", class: "block text-sm font-medium text-slate-700" %>
    <%= form.text_area :options_text,
      value: membership_question.options_text,
      rows: 3,
      class: "w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-slate-500 focus:outline-none focus:ring",
      placeholder: "Enter one option per line" %>
    <p class="text-xs text-slate-500">Provide at least two choices. Members will pick one option during checkout.</p>
  </div>

  <div class="space-y-1">
    <%= form.label :help_text, "Helper text (optional)", class: "block text-sm font-medium text-slate-700" %>
    <%= form.text_area :help_text,
      rows: 2,
      class: "w-full rounded border border-slate-300 px-3 py-2 text-sm focus:border-slate-500 focus:outline-none focus:ring",
      placeholder: "Add context or instructions for members completing this question." %>
  </div>

  <div class="flex items-center justify-end gap-3">
    <% if membership_question.persisted? %>
      <%= link_to "Cancel",
        admin_club_membership_question_path(club, membership_question),
        data: { turbo_frame: dom_id(membership_question) },
        class: "text-sm font-medium text-slate-500 hover:text-slate-700" %>
    <% else %>
      <button
        type="button"
        class="text-sm font-medium text-slate-500 hover:text-slate-700"
        data-action="modal#close"
      >
        Cancel
      </button>
    <% end %>
    <%= form.submit(membership_question.persisted? ? "Save changes" : "Create question",
      class: "inline-flex items-center rounded bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800") %>
  </div>
  <% end %>
<% end %>
