<section class="plans">
  <header class="plans__header">
    <h1>Membership plans</h1>
    <p>Select a plan and assign it to yourself or a linked member.</p>
  </header>

  <% if @plans.empty? %>
    <p class="plans__empty">No plans are available right now.</p>
  <% elsif @members.empty? %>
    <div class="plans__empty">
      <p>You do not have any members linked to your profile yet.</p>
      <p>Please contact your club administrator if you need assistance.</p>
    </div>
  <% else %>
    <div class="plans__list">
      <% @plans.each do |plan| %>
        <% product = plan.product %>
        <article class="plans__item">
          <h2><%= product.name %></h2>
          <p class="plans__price"><%= number_to_currency(product.price_cents / 100.0, unit: product.price_currency) %></p>
          <% if plan.plan_type_recurring? %>
            <p class="plans__detail">Recurring every <%= plan.interval_months %> month(s)</p>
          <% elsif plan.plan_type_installments? %>
            <p class="plans__detail"><%= plan.installments_count %> installments</p>
          <% else %>
            <p class="plans__detail">Once-off payment</p>
          <% end %>

          <%= form_with url: club_cart_items_path, method: :post, class: "plans__form", local: true do %>
            <%= hidden_field_tag :plan_id, plan.id %>
            <div class="plans__field">
              <%= label_tag :member_id, "Member", class: "plans__label" %>
              <%= select_tag :member_id,
                    options_from_collection_for_select(@members, :id, :display_name),
                    include_blank: "- Select member -",
                    required: true,
                    class: "plans__select" %>
            </div>
            <div class="plans__field">
              <%= label_tag :quantity, "Quantity", class: "plans__label" %>
              <%= number_field_tag :quantity, 1, min: 1, class: "plans__input" %>
            </div>
            <%= submit_tag "Add to cart", class: "plans__submit" %>
          <% end %>
        </article>
      <% end %>
    </div>
  <% end %>
</section>
