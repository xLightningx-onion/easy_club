<% content_for :title, "#{@club.name} · Admin" %>
<% content_for :page_heading, @club.name %>

<section class="rounded-lg border border-slate-200 bg-white shadow-sm">
  <header class="flex flex-wrap items-center justify-between gap-3 border-b border-slate-200 px-4 py-3">
    <h2 class="text-base font-semibold text-slate-900">Club details</h2>
    <div class="flex flex-wrap items-center gap-2">
      <%= link_to "Edit", edit_admin_club_path(@club), class: "rounded bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800" %>
      <%= button_to "Impersonate", impersonate_admin_club_path(@club), method: :post, form: { class: "inline" }, class: "rounded border border-slate-300 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" %>
      <%= button_to "Delete", admin_club_path(@club), method: :delete, data: { turbo_confirm: "Delete this club?" }, form: { class: "inline" }, class: "rounded bg-rose-600 px-3 py-2 text-sm font-medium text-white hover:bg-rose-500" %>
    </div>
  </header>

  <dl class="grid gap-4 px-4 py-4 text-sm text-slate-600 md:grid-cols-2">
    <div>
      <dt class="font-medium text-slate-500">Subdomain</dt>
      <dd class="text-slate-900"><%= @club.subdomain.presence || "—" %></dd>
    </div>
    <div>
      <dt class="font-medium text-slate-500">Primary domain</dt>
      <dd class="text-slate-900"><%= @club.primary_domain.presence || "—" %></dd>
    </div>
    <div>
      <dt class="font-medium text-slate-500">Sender email</dt>
      <dd class="text-slate-900"><%= @club.sender_email.presence || "—" %></dd>
    </div>
    <div>
      <dt class="font-medium text-slate-500">Members</dt>
      <dd class="text-slate-900"><%= @members_count %></dd>
    </div>
    <div>
      <dt class="font-medium text-slate-500">Invoices</dt>
      <dd class="text-slate-900"><%= @invoices_count %></dd>
    </div>
    <div>
      <dt class="font-medium text-slate-500">Payments processed</dt>
      <dd class="text-slate-900"><%= @payments_total.format %></dd>
    </div>
  </dl>
</section>

<section
  class="mt-8 rounded-lg border border-slate-200 bg-white shadow-sm"
  data-controller="modal"
  data-action="turbo:submit-end->modal#handleSubmitEnd"
>
  <header class="flex flex-col gap-2 border-b border-slate-200 px-4 py-4 md:flex-row md:items-center md:justify-between">
    <div>
      <h2 class="text-base font-semibold text-slate-900">Membership types</h2>
      <p class="text-sm text-slate-500">Configure the eligibility rules and pricing options that members see during registration.</p>
    </div>
    <turbo-frame id="<%= dom_id(@club, :new_membership_type) %>">
      <%= render "admin/clubs/membership_types/new_button", club: @club %>
    </turbo-frame>
  </header>

  <div class="border-t border-slate-200">
    <turbo-frame id="<%= dom_id(@club, :membership_types) %>">
      <%= render "admin/clubs/membership_types/list",
                 club: @club,
                 membership_types: @membership_types %>
    </turbo-frame>
  </div>

  <div
    class="fixed inset-0 z-50 hidden"
    data-modal-target="wrapper"
    data-action="keydown.esc->modal#close"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    tabindex="-1"
  >
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" data-action="click->modal#close"></div>
    <div class="relative z-10 flex min-h-full items-center justify-center p-4">
      <div class="w-full max-w-2xl overflow-hidden rounded-lg bg-white shadow-xl">
        <header class="flex items-center justify-between border-b border-slate-200 px-4 py-3">
          <h3 class="text-base font-semibold text-slate-900" data-modal-target="title">Add membership type</h3>
          <button
            type="button"
            class="rounded-full p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-700"
            data-action="modal#close"
            aria-label="Close modal"
            data-modal-initial-focus
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="px-4 py-4">
          <turbo-frame
            id="<%= dom_id(@club, :membership_type_modal) %>"
            data-modal-target="frame"
            loading="lazy"
          ></turbo-frame>
        </div>
      </div>
    </div>
  </div>
</section>

<section
  class="mt-8 rounded-lg border border-slate-200 bg-white shadow-sm"
  data-controller="modal"
  data-action="turbo:submit-end->modal#handleSubmitEnd"
>
  <header class="flex flex-col gap-2 border-b border-slate-200 px-4 py-4 md:flex-row md:items-center md:justify-between">
    <div>
      <h2 class="text-base font-semibold text-slate-900">Membership questions</h2>
      <p class="text-sm text-slate-500">Customise what members need to answer when they purchase memberships. Questions update instantly.</p>
    </div>
    <turbo-frame id="<%= dom_id(@club, :new_membership_question) %>">
      <%= render "admin/clubs/membership_questions/new_button", club: @club %>
    </turbo-frame>
  </header>
  <div class="border-t border-slate-200">
    <turbo-frame id="<%= dom_id(@club, :membership_questions) %>">
      <%= render "admin/clubs/membership_questions/list",
                 club: @club,
                 membership_questions: @membership_questions %>
    </turbo-frame>
  </div>

  <div
    class="fixed inset-0 z-50 hidden"
    data-modal-target="wrapper"
    data-action="keydown.esc->modal#close"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    tabindex="-1"
  >
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" data-action="click->modal#close"></div>
    <div class="relative z-10 flex min-h-full items-center justify-center p-4">
      <div class="w-full max-w-2xl overflow-hidden rounded-lg bg-white shadow-xl">
        <header class="flex items-center justify-between border-b border-slate-200 px-4 py-3">
          <h3 class="text-base font-semibold text-slate-900" data-modal-target="title">Add membership question</h3>
          <button
            type="button"
            class="rounded-full p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-700"
            data-action="modal#close"
            aria-label="Close modal"
            data-modal-initial-focus
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="px-4 py-4">
          <turbo-frame
            id="<%= dom_id(@club, :membership_question_modal) %>"
            data-modal-target="frame"
            loading="lazy"
          ></turbo-frame>
        </div>
      </div>
    </div>
  </div>
</section>
