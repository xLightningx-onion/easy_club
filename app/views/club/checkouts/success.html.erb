<% content_for :title, "Payment successful Â· #{current_club.name}" %>

<div class="mx-auto max-w-4xl px-4 py-12">
  <div class="overflow-hidden rounded-3xl border border-emerald-200 bg-white shadow-sm">
    <div class="space-y-4 px-8 py-10 text-center">
      <div class="mx-auto flex h-14 w-14 items-center justify-center rounded-full bg-emerald-100 text-emerald-600">
        <svg class="h-7 w-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="m5 13 4 4L19 7" />
        </svg>
        <span class="sr-only">Payment successful</span>
      </div>
      <h1 class="text-2xl font-semibold text-slate-900">Payment received</h1>
      <p class="mx-auto max-w-2xl text-sm text-slate-600">
        Thanks for completing checkout. We emailed a receipt to
        <span class="font-medium text-slate-900"><%= @order.user.email %></span>.
        Memberships listed below are now active.
      </p>
    </div>

    <dl class="grid gap-6 border-t border-emerald-100 bg-emerald-50 px-8 py-6 text-sm text-slate-700 sm:grid-cols-3">
      <div>
        <dt class="text-[11px] font-semibold uppercase tracking-wide text-emerald-700">Order reference</dt>
        <dd class="mt-1 font-semibold text-slate-900"><%= @order.number %></dd>
      </div>
      <div>
        <dt class="text-[11px] font-semibold uppercase tracking-wide text-emerald-700">Paid on</dt>
        <dd class="mt-1 font-medium text-slate-900">
          <%= @order.paid_at ? l(@order.paid_at, format: :long) : "Pending" %>
        </dd>
      </div>
      <div>
        <dt class="text-[11px] font-semibold uppercase tracking-wide text-emerald-700">Total amount</dt>
        <dd class="mt-1 text-base font-semibold text-slate-900">
          <%= number_to_currency(@order.total_cents / 100.0, unit: @order.total_currency) %>
        </dd>
      </div>
    </dl>
  </div>

  <section class="mt-10 grid gap-6 lg:grid-cols-[3fr_2fr]">
    <div class="space-y-4 rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-sm">
      <header class="flex items-center justify-between">
        <h2 class="text-base font-semibold text-slate-900">Memberships activated</h2>
        <%= link_to "Add another membership", members_membership_registration_path(step: "personal", club_id: current_club.id, restart: true), class: "text-xs font-semibold text-slate-600 transition hover:text-slate-900" %>
      </header>

      <% if @order.order_items.any? %>
        <div class="space-y-4">
          <% @order.order_items.each do |item| %>
            <% member = item.member %>
            <% plan = item.plan %>
            <% product = plan&.product %>

            <article class="rounded-xl border border-slate-200 px-4 py-4">
              <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
                <div class="space-y-1">
                  <p class="text-sm font-semibold text-slate-900"><%= member&.display_name || "Member" %></p>
                  <p class="text-xs text-slate-500"><%= product&.name || "Membership plan" %></p>
                  <% if plan&.plan_type_recurring? %>
                    <p class="text-[11px] uppercase tracking-wide text-slate-400">Recurring every <%= plan.interval_months %> month(s)</p>
                  <% elsif plan&.plan_type_installments? %>
                    <p class="text-[11px] uppercase tracking-wide text-slate-400"><%= plan.installments_count %> installments</p>
                  <% end %>
                </div>
                <div class="text-right">
                  <p class="text-sm font-semibold text-slate-900">
                    <%= number_to_currency(item.total_price_cents / 100.0, unit: item.total_price_currency) %>
                  </p>
                  <p class="text-xs text-slate-500">Qty <%= item.quantity %></p>
                </div>
              </div>
            </article>
          <% end %>
        </div>
      <% else %>
        <div class="rounded-xl border border-dashed border-slate-300 bg-slate-50 px-6 py-8 text-center">
          <p class="text-sm text-slate-500">No order items were recorded for this payment.</p>
        </div>
      <% end %>
    </div>

    <aside class="space-y-5 rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-sm">
      <div class="space-y-2">
        <h3 class="text-sm font-semibold text-slate-900">Payment summary</h3>
        <dl class="space-y-3 text-sm text-slate-600">
          <div class="flex items-center justify-between">
            <dt>Subtotal</dt>
            <dd class="font-medium text-slate-900"><%= number_to_currency(@order.subtotal_cents / 100.0, unit: @order.subtotal_currency) %></dd>
          </div>
          <% if @order.discount_cents.to_i.positive? %>
            <div class="flex items-center justify-between text-rose-600">
              <dt>Discounts</dt>
              <dd>-<%= number_to_currency(@order.discount_cents / 100.0, unit: @order.discount_currency) %></dd>
            </div>
          <% end %>
          <div class="flex items-center justify-between border-t border-slate-200 pt-3 text-base font-semibold text-slate-900">
            <dt>Total paid</dt>
            <dd><%= number_to_currency(@order.total_cents / 100.0, unit: @order.total_currency) %></dd>
          </div>
        </dl>
      </div>

      <div class="space-y-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-4 text-sm text-slate-600">
        <div class="flex items-start justify-between gap-4">
          <span class="text-slate-500">Payment method</span>
          <span class="text-right font-medium text-slate-900"><%= @order.payment_method&.masked_label || "Card payment" %></span>
        </div>
        <% if @payment_transaction&.response_reference.present? %>
          <div class="flex items-start justify-between gap-4">
            <span class="text-slate-500">Gateway reference</span>
            <span class="text-right font-medium text-slate-900"><%= @payment_transaction.response_reference %></span>
          </div>
        <% end %>
        <% if @payment_transaction&.processed_at.present? %>
          <div class="flex items-start justify-between gap-4">
            <span class="text-slate-500">Processed at</span>
            <span class="text-right font-medium text-slate-900"><%= l(@payment_transaction.processed_at, format: :long) %></span>
          </div>
        <% end %>
      </div>

      <div class="space-y-2 text-xs text-slate-500">
        <p>Need a record? You can download detailed payment reports from the invoices area of the club dashboard.</p>
      </div>

      <div class="flex flex-wrap items-center gap-3">
        <%= link_to "Back to dashboard", club_dashboard_path, class: "inline-flex flex-1 items-center justify-center rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-slate-800" %>
        <%= link_to "View invoices", club_invoices_path, class: "inline-flex flex-1 items-center justify-center rounded-full border border-slate-300 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-400 hover:text-slate-900" %>
      </div>
    </aside>
  </section>
</div>
