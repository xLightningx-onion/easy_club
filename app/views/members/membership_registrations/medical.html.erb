<%= content_for :club_header do %>
  <%= render "members/membership_registrations/club_header", club: @club %>
<% end %>

<%= content_for :progress_bar do %>
  <%= render "members/membership_registrations/progress_bar", step_count: 2 %>
<% end %>


<div class="py-3">
  <h2 class="text-2xl lg:text-3xl font-semibold text-center lg:text-start mb-3">
    Medical Questions
  </h2> 
  <div class="space-y-2 text-center lg:text-start">
    <p class="text-sm text-slate-600">To ensure your safety, we need some basic medical details.</p>
  </div>
  <%= form_with model: @form, url: members_membership_registration_path(step: "medical", club_id: @club), method: :patch, class: "space-y-8" do |f| %>
    <%= render "shared/form_errors", resource: @form if @form.errors.any? && lookup_context.exists?("shared/_form_errors") %>

    <div class="grid gap-6 md:grid-cols-2">
      <div>
        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-500">Medical aid name (optional)</label>
        <%= f.text_field :medical_aid_name, class: "w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring" %>
      </div>

      <div>
        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-500">Medical aid number (optional)</label>
        <%= f.text_field :medical_aid_number, class: "w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring" %>
      </div>

      <div>
        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-500">Emergency contact name</label>
        <%= f.text_field :emergency_contact_name, class: "w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring", required: true %>
      </div>

      <div>
        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-500">Emergency contact number</label>
        <%= f.telephone_field :emergency_contact_number, class: "w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring", required: true %>
      </div>

      <div class="md:col-span-2">
        <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-500">Medical notes (optional)</label>
        <%= f.text_area :medical_notes, rows: 4, class: "w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring" %>
      </div>
    </div>

    <% if @medical_questions.any? %>
      <div class="space-y-4">
        <h2 class="text-lg font-semibold text-slate-900">Medical survey</h2>
        <% @medical_questions.each do |question| %>
          <% response_value = @form.survey_responses[question.id.to_s] %>
          <div class="space-y-2">
            <label class="text-sm font-medium text-slate-700" for="medical-question-<%= question.id %>">
              <%= question.prompt %>
              <% if question.required? %>
                <span class="text-rose-600">*</span>
              <% end %>
            </label>
            <% case question.question_type %>
            <% when "boolean" %>
              <div class="flex items-center gap-4">
                <label class="inline-flex items-center gap-2 text-sm text-slate-600">
                  <input type="radio" name="membership_registration_form[survey_responses][<%= question.id %>]" value="yes" class="h-4 w-4 border-slate-300 text-slate-900 focus:ring-slate-500" <%= response_value == "yes" ? "checked" : nil %> <%= question.required? ? "required" : nil %>>
                  <span>Yes</span>
                </label>
                <label class="inline-flex items-center gap-2 text-sm text-slate-600">
                  <input type="radio" name="membership_registration_form[survey_responses][<%= question.id %>]" value="no" class="h-4 w-4 border-slate-300 text-slate-900 focus:ring-slate-500" <%= response_value == "no" ? "checked" : nil %>>
                  <span>No</span>
                </label>
              </div>
            <% when "long_text" %>
              <textarea id="medical-question-<%= question.id %>" name="membership_registration_form[survey_responses][<%= question.id %>]" rows="3" class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring" <%= question.required? ? "required" : nil %>><%= response_value %></textarea>
            <% else %>
              <input id="medical-question-<%= question.id %>" type="text" name="membership_registration_form[survey_responses][<%= question.id %>]" value="<%= response_value %>" class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-slate-500 focus:outline-none focus:ring" <%= question.required? ? "required" : nil %>>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="flex items-center justify-between">
      <%= link_to "Previous", members_membership_registration_path(step: "personal", club_id: @club, phase: "membership_type"), class: "rounded border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900" %>
      <%= f.submit "Next", class: "inline-flex min-w-[160px] items-center justify-center rounded px-6 py-3 text-sm font-semibold text-white shadow transition hover:bg-slate-800 bg-easyclub-primary" %>
    </div>
  <% end %>
</div>
